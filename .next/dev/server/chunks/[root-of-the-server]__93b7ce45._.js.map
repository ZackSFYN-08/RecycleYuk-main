{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/RecycleYuk-revision/RecycleYuk/RecycleYuk/src/app/api/payment/route.js"],"sourcesContent":["// src/app/api/payment/route.js\r\nimport { NextResponse } from 'next/server';\r\nimport Midtrans from 'midtrans-client'; // Ubah require jadi import\r\n\r\nexport async function POST(request) {\r\n  // 1. Terima data dari Frontend\r\n  const { id, amount, firstName, email, title } = await request.json();\r\n\r\n  // 2. Inisialisasi Midtrans\r\n  const snap = new Midtrans.Snap({\r\n    isProduction: false,\r\n    serverKey: process.env.MIDTRANS_SERVER_KEY,\r\n  });\r\n\r\n  // 3. Pastikan amount adalah integer (bulat) untuk mata uang IDR\r\n  const grossAmount = Math.round(amount);\r\n\r\n  // 4. Konfigurasi Parameter\r\n  const parameter = {\r\n    transaction_details: {\r\n      order_id: `TRX-${id}-${Date.now()}`, // Prefix TRX lebih umum\r\n      gross_amount: grossAmount,\r\n    },\r\n    item_details: [{\r\n      id: String(id),       // Pastikan string\r\n      price: grossAmount,\r\n      quantity: 1,\r\n      name: title ? title.substring(0, 50) : \"Layanan Kebersihan\", // Fallback name\r\n    }],\r\n    customer_details: {\r\n      first_name: firstName || \"Pelanggan\",\r\n      email: email || \"customer@example.com\",\r\n    },\r\n    credit_card: {\r\n      secure: true,\r\n    },\r\n  };\r\n\r\n  try {\r\n    const transaction = await snap.createTransaction(parameter);\r\n    return NextResponse.json({ token: transaction.token });\r\n  } catch (error) {\r\n    console.error(\"Midtrans Error:\", error.message); // Log di terminal server\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA,+BAA+B;AAC/B;AACA,gXAAwC,2BAA2B;;;AAE5D,eAAe,KAAK,OAAO;IAChC,+BAA+B;IAC/B,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;IAElE,2BAA2B;IAC3B,MAAM,OAAO,IAAI,2NAAQ,CAAC,IAAI,CAAC;QAC7B,cAAc;QACd,WAAW,QAAQ,GAAG,CAAC,mBAAmB;IAC5C;IAEA,gEAAgE;IAChE,MAAM,cAAc,KAAK,KAAK,CAAC;IAE/B,2BAA2B;IAC3B,MAAM,YAAY;QAChB,qBAAqB;YACnB,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI;YACnC,cAAc;QAChB;QACA,cAAc;YAAC;gBACb,IAAI,OAAO;gBACX,OAAO;gBACP,UAAU;gBACV,MAAM,QAAQ,MAAM,SAAS,CAAC,GAAG,MAAM;YACzC;SAAE;QACF,kBAAkB;YAChB,YAAY,aAAa;YACzB,OAAO,SAAS;QAClB;QACA,aAAa;YACX,QAAQ;QACV;IACF;IAEA,IAAI;QACF,MAAM,cAAc,MAAM,KAAK,iBAAiB,CAAC;QACjD,OAAO,mNAAY,CAAC,IAAI,CAAC;YAAE,OAAO,YAAY,KAAK;QAAC;IACtD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB,MAAM,OAAO,GAAG,yBAAyB;QAC1E,OAAO,mNAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}